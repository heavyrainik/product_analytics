create table fediq_team.novochahtinsk_new_client_201909 as(
    with p as (select distinct(passenger_id) from fediq_team.novochahtinsk_orders_201909
    where dttm >= '2018-01-01' and dttm < '2018-02-01' and status = 'complete'
    except
    select distinct(passenger_id) from fediq_team.novochahtinsk_orders_201909
    where dttm < '2018-01-01'and status = 'complete')
    select count(*), ('2018-01-01')::timestamp
    from p
);

insert into fediq_team.novochahtinsk_new_client_201909 (
    with p as (select distinct(passenger_id) from fediq_team.novochahtinsk_orders_201909
    where dttm >= '2018-02-01' and dttm < '2018-03-01' and status = 'complete'
    except
    select distinct(passenger_id) from fediq_team.novochahtinsk_orders_201909
    where dttm < '2018-02-01'and status = 'complete')
    select count(*), ('2018-02-01')::timestamp
    from p
);

insert into fediq_team.novochahtinsk_new_client_201909 (
    with p as (select distinct(passenger_id) from fediq_team.novochahtinsk_orders_201909
    where dttm >= '2018-03-01' and dttm < '2018-04-01' and status = 'complete'
    except
    select distinct(passenger_id) from fediq_team.novochahtinsk_orders_201909
    where dttm < '2018-03-01'and status = 'complete')
    select count(*), ('2018-03-01')::timestamp
    from p
);
insert into fediq_team.novochahtinsk_new_client_201909 (
    with p as (select distinct(passenger_id) from fediq_team.novochahtinsk_orders_201909
    where dttm >= '2018-04-01' and dttm < '2018-05-01' and status = 'complete'
    except
    select distinct(passenger_id) from fediq_team.novochahtinsk_orders_201909
    where dttm < '2018-04-01'and status = 'complete')
    select count(*), ('2018-04-01')::timestamp
    from p
);
insert into fediq_team.novochahtinsk_new_client_201909 (
    with p as (select distinct(passenger_id) from fediq_team.novochahtinsk_orders_201909
    where dttm >= '2018-05-01' and dttm < '2018-06-01' and status = 'complete'
    except
    select distinct(passenger_id) from fediq_team.novochahtinsk_orders_201909
    where dttm < '2018-05-01'and status = 'complete')
    select count(*), ('2018-05-01')::timestamp
    from p
);
insert into fediq_team.novochahtinsk_new_client_201909 (
    with p as (select distinct(passenger_id) from fediq_team.novochahtinsk_orders_201909
    where dttm >= '2018-06-01' and dttm < '2018-07-01' and status = 'complete'
    except
    select distinct(passenger_id) from fediq_team.novochahtinsk_orders_201909
    where dttm < '2018-06-01'and status = 'complete')
    select count(*), ('2018-06-01')::timestamp
    from p
);
insert into fediq_team.novochahtinsk_new_client_201909 (
    with p as (select distinct(passenger_id) from fediq_team.novochahtinsk_orders_201909
    where dttm >= '2018-07-01' and dttm < '2018-08-01' and status = 'complete'
    except
    select distinct(passenger_id) from fediq_team.novochahtinsk_orders_201909
    where dttm < '2018-07-01'and status = 'complete')
    select count(*), ('2018-07-01')::timestamp
    from p
);
insert into fediq_team.novochahtinsk_new_client_201909 (
    with p as (select distinct(passenger_id) from fediq_team.novochahtinsk_orders_201909
    where dttm >= '2018-08-01' and dttm < '2018-09-01' and status = 'complete'
    except
    select distinct(passenger_id) from fediq_team.novochahtinsk_orders_201909
    where dttm < '2018-08-01'and status = 'complete')
    select count(*), ('2018-08-01')::timestamp
    from p
);
insert into fediq_team.novochahtinsk_new_client_201909 (
    with p as (select distinct(passenger_id) from fediq_team.novochahtinsk_orders_201909
    where dttm >= '2018-09-01' and dttm < '2018-10-01' and status = 'complete'
    except
    select distinct(passenger_id) from fediq_team.novochahtinsk_orders_201909
    where dttm < '2018-09-01'and status = 'complete')
    select count(*), ('2018-09-01')::timestamp
    from p
);
insert into fediq_team.novochahtinsk_new_client_201909 (
    with p as (select distinct(passenger_id) from fediq_team.novochahtinsk_orders_201909
    where dttm >= '2018-10-01' and dttm < '2018-11-01' and status = 'complete'
    except
    select distinct(passenger_id) from fediq_team.novochahtinsk_orders_201909
    where dttm < '2018-10-01'and status = 'complete')
    select count(*), ('2018-10-01')::timestamp
    from p
);
insert into fediq_team.novochahtinsk_new_client_201909 (
    with p as (select distinct(passenger_id) from fediq_team.novochahtinsk_orders_201909
    where dttm >= '2018-11-01' and dttm < '2018-12-01' and status = 'complete'
    except
    select distinct(passenger_id) from fediq_team.novochahtinsk_orders_201909
    where dttm < '2018-11-01'and status = 'complete')
    select count(*), ('2018-11-01')::timestamp
    from p
);
insert into fediq_team.novochahtinsk_new_client_201909 (
    with p as (select distinct(passenger_id) from fediq_team.novochahtinsk_orders_201909
    where dttm >= '2018-12-01' and dttm < '2019-01-01' and status = 'complete'
    except
    select distinct(passenger_id) from fediq_team.novochahtinsk_orders_201909
    where dttm < '2018-12-01'and status = 'complete')
    select count(*), ('2018-12-01')::timestamp
    from p
);
insert into fediq_team.novochahtinsk_new_client_201909 (
    with p as (select distinct(passenger_id) from fediq_team.novochahtinsk_orders_201909
    where dttm >= '2019-01-01' and dttm < '2019-02-01' and status = 'complete'
    except
    select distinct(passenger_id) from fediq_team.novochahtinsk_orders_201909
    where dttm < '2019-01-01'and status = 'complete')
    select count(*), ('2019-01-01')::timestamp
    from p
);
insert into fediq_team.novochahtinsk_new_client_201909 (
    with p as (select distinct(passenger_id) from fediq_team.novochahtinsk_orders_201909
    where dttm >= '2019-02-01' and dttm < '2019-03-01' and status = 'complete'
    except
    select distinct(passenger_id) from fediq_team.novochahtinsk_orders_201909
    where dttm < '2019-02-01'and status = 'complete')
    select count(*), ('2019-02-01')::timestamp
    from p
);
insert into fediq_team.novochahtinsk_new_client_201909 (
    with p as (select distinct(passenger_id) from fediq_team.novochahtinsk_orders_201909
    where dttm >= '2019-03-01' and dttm < '2019-04-01' and status = 'complete'
    except
    select distinct(passenger_id) from fediq_team.novochahtinsk_orders_201909
    where dttm < '2019-03-01'and status = 'complete')
    select count(*), ('2019-03-01')::timestamp
    from p
);
insert into fediq_team.novochahtinsk_new_client_201909 (
    with p as (select distinct(passenger_id) from fediq_team.novochahtinsk_orders_201909
    where dttm >= '2019-04-01' and dttm < '2019-05-01' and status = 'complete'
    except
    select distinct(passenger_id) from fediq_team.novochahtinsk_orders_201909
    where dttm < '2019-04-01'and status = 'complete')
    select count(*), ('2019-04-01')::timestamp
    from p
);
insert into fediq_team.novochahtinsk_new_client_201909 (
    with p as (select distinct(passenger_id) from fediq_team.novochahtinsk_orders_201909
    where dttm >= '2019-05-01' and dttm < '2019-06-01' and status = 'complete'
    except
    select distinct(passenger_id) from fediq_team.novochahtinsk_orders_201909
    where dttm < '2019-05-01'and status = 'complete')
    select count(*), ('2019-05-01')::timestamp
    from p
);
insert into fediq_team.novochahtinsk_new_client_201909 (
    with p as (select distinct(passenger_id) from fediq_team.novochahtinsk_orders_201909
    where dttm >= '2019-06-01' and dttm < '2019-07-01' and status = 'complete'
    except
    select distinct(passenger_id) from fediq_team.novochahtinsk_orders_201909
    where dttm < '2019-06-01'and status = 'complete')
    select count(*), ('2019-06-01')::timestamp
    from p
);
insert into fediq_team.novochahtinsk_new_client_201909 (
    with p as (select distinct(passenger_id) from fediq_team.novochahtinsk_orders_201909
    where dttm >= '2019-07-01' and dttm < '2019-08-01' and status = 'complete'
    except
    select distinct(passenger_id) from fediq_team.novochahtinsk_orders_201909
    where dttm < '2019-07-01'and status = 'complete')
    select count(*), ('2019-07-01')::timestamp
    from p
);
insert into fediq_team.novochahtinsk_new_client_201909 (
    with p as (select distinct(passenger_id) from fediq_team.novochahtinsk_orders_201909
    where dttm >= '2019-08-01' and dttm < '2019-09-01' and status = 'complete'
    except
    select distinct(passenger_id) from fediq_team.novochahtinsk_orders_201909
    where dttm < '2019-08-01'and status = 'complete')
    select count(*), ('2019-08-01')::timestamp
    from p
);
insert into fediq_team.novochahtinsk_new_client_201909 (
    with p as (select distinct(passenger_id) from fediq_team.novochahtinsk_orders_201909
    where dttm >= '2019-09-01' and dttm < '2019-10-01' and status = 'complete'
    except
    select distinct(passenger_id) from fediq_team.novochahtinsk_orders_201909
    where dttm < '2019-09-01'and status = 'complete')
    select count(*), ('2019-09-01')::timestamp
    from p
);
